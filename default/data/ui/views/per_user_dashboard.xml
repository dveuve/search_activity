<form script="set_app_token.js,check_data_availability.js">
  <label>Per User Search Activity</label>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="field1" searchWhenChanged="true">
      <label></label>
      <default>
        <earliestTime>-30d@d</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="dropdown" token="user" searchWhenChanged="true">
      <label>User</label>
      <populatingSearch fieldForLabel="user" fieldForValue="user">| tstats local=t count  from `SA_SearchHistory` groupby `UserOrName` | fields - count | sort `UserOrName` | rename `UserOrName` as user</populatingSearch>
    </input>
  </fieldset>
  <row>
      <html>
        <h1>Overview</h1>
        <div id="HighLevelInfo">
<h3>User Information</h3>

<table style="width:100%">
	<tr style="border:1px black solid;">
		<td>Name:</td>
		<td style="border-right:1px black solid;">$background_cn$</td>
		<td>Company:</td>
		<td style="border-right:1px black solid;">$background_company$</td>
		<td>Department</td>
		<td style="border-right:1px black solid;">$background_department$</td>
		<td>Email</td>
		<td>$background_mail$</td>
	</tr>
	<tr style="border:1px black solid;">
		<td>Username</td>
		<td style="border-right:1px black solid;">$background_splunk_username$</td>
		<td>Title</td>
		<td style="border-right:1px black solid;">$background_title$</td>
		<td>Number of Reports</td>
		<td style="border-right:1px black solid;">$background_NumReports$</td>
		<td>Description</td>
		<td>$background_description$</td>
	</tr>
	<tr style="border:1px black solid;">
		<td>Phone:</td>
		<td style="border-right:1px black solid;">$background_telephoneNumber$</td>
		<td>Office Location:</td>
		<td style="border-right:1px black solid;">$background_physicalDeliveryOfficeName$</td>
		<td>Management Chain</td>
		<td style="border-right:1px black solid;">$background_ManagementChain$</td>
		<td>Number of Direct Reports:</td>
		<td>$background_NumDirectReports$</td>
	</tr>
	<tr style="border:1px black solid;">
		<td>Office</td>
		<td style="border-right:1px black solid;">$background_o$</td>
		<td>State</td>
		<td style="border-right:1px black solid;">$background_st$</td>
		<td>Location</td>
		<td style="border-right:1px black solid;">$background_l$</td>
		<td>Country</td>
		<td>$background_c$</td>
	</tr>
</table>

<h3>Search Information</h3>
        <p>$background_somename$ was active for $background_NumDays$ day, and ran a total of $background_Totalsum$ searches ($background_Avgsum$ per day).</p>
<table style="width:100%">
	<tr>
		<td style="border:1px black solid;">Search Type</td>
		<td style="border:1px black solid;">Number of Queries Overall</td>
		<td style="border:1px black solid;">Number of Queries Per Day</td>
		<td style="border:1px black solid;">Average Runtime of Queries</td>
	</tr>
	<tr>
		<td style="border:1px black solid;">AdHoc</td>
		<td style="border:1px black solid;">$background_Totaladhoc$</td>
		<td style="border:1px black solid;">$background_Avgadhoc$</td>
		<td style="border:1px black solid;">$background_AvgRT_Totaladhoc$</td>
	</tr>
	<tr>
		<td style="border:1px black solid;">Dashboard</td>
		<td style="border:1px black solid;">$background_Totaldashboard$</td>
		<td style="border:1px black solid;">$background_Avgdashboard$</td>
		<td style="border:1px black solid;">$background_AvgRT_Totaldashboard$</td>
	</tr>
	<tr>
		<td style="border:1px black solid;">Realtime</td>
		<td style="border:1px black solid;">$background_Totalrealtime$</td>
		<td style="border:1px black solid;">$background_Avgrealtime$</td>
		<td style="border:1px black solid;">$background_AvgRT_Totalrealtime$</td>
	</tr>
	<tr>
		<td style="border:1px black solid;">Scheduled</td>
		<td style="border:1px black solid;">$background_Totalscheduled$</td>
		<td style="border:1px black solid;">$background_Avgscheduled$</td>
		<td style="border:1px black solid;">$background_AvgRT_Totalscheduled$</td>
	</tr>
	<tr>
		<td style="border:1px black solid;">Summarization</td>
		<td style="border:1px black solid;">$background_Totalsummarization$</td>
		<td style="border:1px black solid;">$background_Avgsummarization$</td>
		<td style="border:1px black solid;">$background_AvgRT_Totalsummarization$</td>
	</tr> <!-- 
	<tr>
		<td  style="border:1px black solid;">Total</td>
		<td  style="border:1px black solid;">$background_Totalsum$</td>
		<td  style="border:1px black solid;">$background_Avgsum$</td>
		<td  style="border:1px black solid;">$background_AvgRT_Totalsum$</td>
	</tr> -->
</table>
        </div>
        <p>Please note that the five indicators directly below cover only ad hoc searching, and are only intended as a general gauge of user experience.</p>
        <p>This app has a capability of tracking groups of users (such as new users, or particular projects, or other categories of user). Click <a href="/app/search_activity/add_to_tagged_users">here</a> to tag $background_splunk_username$.
          </p>
      </html>
  </row>
  <row>
      <html>
        <h2>Per User Timeline View</h2>
        <p>To view $background_splunk_username$'s activity in chronological order, please visit the <a href="/app/search_activity/per_user_timeline?form.user=$background_splunk_username$">Per User Timeline View</a>.</p>
      </html>
  </row>
  <row>
      <chart>
        <title>Search Complexity Score</title>
        <searchString>
          | tstats prestats=t local=t count from `SA_SearchHistory` where user=$user$ searchtype=adhoc groupby searchcommands , user| stats count by searchcommands, user| eval maturity=`eval_high_complexity_search_commands` | eval maturity=`eval_med_complexity_search_commands` | eval maturity=`eval_low_complexity_search_commands`  | stats sum(eval(if(searchcommands="search",count,null))) as search_num sum(maturity) as maturity | eval "Search Complexity Score"=if(maturity/search_num&gt;`max_search_complexity_rating`,`max_search_complexity_rating`,1+round(maturity/search_num,0)) | fields "Search Complexity Score"
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">markerGauge</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">[1,"2","3","5"]</option>
        <option name="charting.gaugeColors">[0xf7912c,0xFFE800,0x7e9f44]</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
      <chart>
        <title>Search Accuracy (slow searches)</title>
        <searchString>
          | tstats  local=t avg(accuracy)  from `SA_SearchHistory` where user=$user$ total_run_time&gt;15 result_count&gt;0 searchtype=adhoc
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">markerGauge</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">[0,15,30,100]</option>
        <option name="charting.gaugeColors">[0xf7912c,0xFFE800,0x7e9f44]</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
      <chart>
        <title>Average Search Time (seconds)</title>
        <searchString>
          | tstats  local=t avg(total_run_time) as runtime from `SA_SearchHistory` where  user=$user$ searchtype=adhoc | eval runtime=round(runtime,0)
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="linkView">search</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">markerGauge</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">[0,20,50,120]</option>
        <option name="charting.gaugeColors">[0x7e9f44,0xFFE800,0xBF3030]</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
      <chart>
        <title>Failed Search Percentage</title>
        <searchString>
          | tstats local=t count from `SA_Events` where type=scheduler groupby user status | append [| tstats local=t count  from `SA_SearchHistory` groupby user search_status ]| stats sum(eval(if(status="skipped",count,0))) as SkippedScheduled sum(eval(if(status="success",count,0))) as SuccessfulScheduled sum(eval(if(search_status="failed",count,0))) as FailedAdHoc sum(eval(if(search_status="completed",count,0))) as SuccessfulAdHoc by  user | eval PercentFailed=round(100*(SkippedScheduled+FailedAdHoc)/(SkippedScheduled+FailedAdHoc+SuccessfulScheduled+SuccessfulAdHoc),2) | where user="$user$" | fields PercentFailed
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">markerGauge</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">[0,1,10,100]</option>
        <option name="charting.gaugeColors">[0x84E900,0xFFE800,0xBF3030]</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
      <chart>
        <title>% Searches Needing Investigation</title>
        <searchString>
          | tstats local=t count from `SA_SearchHistory` where user=$user$ groupby ShouldInvestigate | stats sum(eval(if(ShouldInvestigate=1,count,0))) as ShouldInvestigate sum(eval(if(ShouldInvestigate=0,count,0))) as Count | eval Meter = round(ShouldInvestigate/Count*100,1)
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="charting.chart">markerGauge</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">minimal</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">["0","5","10","100"]</option>
        <option name="charting.gaugeColors">[0x84E900,0xFFE800,0xBF3030]</option>
      </chart>
  </row>
  <row>
      <table>
        <title>Comparison to Organization</title>
        <searchString>
          | stats count as bogus | append [ | tstats prestats=t local=t count from `SA_SearchHistory` where searchtype=adhoc groupby searchcommands , user | stats count by searchcommands, user | eval maturity=`eval_high_complexity_search_commands` | eval maturity=`eval_med_complexity_search_commands` | eval maturity=`eval_low_complexity_search_commands` | stats sum(eval(if(searchcommands="search",count,null))) as search_num sum(maturity) as maturity by user | eval "search_complexity_score"=if(maturity/search_num&gt;`max_search_complexity_rating`,`max_search_complexity_rating`,1+round(maturity/search_num,0)) | fields user search_complexity_score | sort - search_complexity_score | streamstats count as complexity_order | eventstats count as NumUsers ] | append [ | tstats local=t avg(accuracy) as Accuracy from `SA_SearchHistory` where total_run_time&gt;15 result_count&gt;0 searchtype=adhoc groupby user | fields user Accuracy | sort - Accuracy | streamstats count as accuracy_order | eventstats count as NumUsers ] | append [ | tstats local=t avg(total_run_time) as runtime from `SA_SearchHistory` where searchtype=adhoc groupby user | eval runtime=round(runtime,0) | stats avg(runtime) as runtime by user | fields user runtime | sort - runtime | streamstats count as runtime_order | eventstats count as NumUsers ] | append [ | tstats local=t count from `SA_Events` where type=scheduler groupby user status | append [ | tstats local=t count from `SA_SearchHistory` groupby user search_status ] | stats sum(eval(if(status="skipped",count,0))) as SkippedScheduled sum(eval(if(status="success",count,0))) as SuccessfulScheduled sum(eval(if(search_status="failed",count,0))) as FailedAdHoc sum(eval(if(search_status="completed",count,0))) as SuccessfulAdHoc by user | eval PercentFailed=round(100*(SkippedScheduled+FailedAdHoc)/(SuccessfulScheduled+SuccessfulAdHoc)) | sort - PercentFailed | streamstats count as FailureOrder | eventstats max(FailureOrder) as NumUsersFailure ] | append [ | tstats local=t count sum(ShouldInvestigate) as ShouldInvestigate from `SA_SearchHistory` where * (SearchHead=*) * * groupby user | sort - ShouldInvestigate | streamstats count as investigate_order | eventstats count as NumInvestigateUsers] | eval "Accuracy Order" = accuracy_order . " out of " . NumUsers | eval "Search Complexity Order" = complexity_order . " out of " . NumUsers | eval "Slow Search Runtime Order" = runtime_order . " out of " . NumUsers | eval "Search Failure Order" = FailureOrder . " out of " . NumUsersFailure | eval "Questionable Search Order" = investigate_order . " out of " . NumInvestigateUsers  | stats values("*Order") as "*Order" by user | fields user "Search Complexity Order" "Accuracy Order" "Slow Search Runtime Order" "Search Failure Order" "Questionable Search Order"| where user="$user$" | lookup LDAPSearch sAMAccountName as user OUTPUTNEW mail
	</searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <chart>
        <title>Search Type over Time</title>
        <searchString>| tstats local=t prestats=t count from `SA_SearchHistory` where user=$user$ groupby _time searchtype  span=1d| timechart bins=50 count by searchtype</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">true</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.overlayFields">"Median Search Run Time"</option>
      </chart>
      <table>
        <title>Overall Details by Search Type</title>
        <searchString>| tstats local=t prestats=t count sum(total_run_time)  from `SA_SearchHistory` where user=$user$ groupby searchtype  | stats count sum(total_run_time) by searchtype</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>Activity By Search Head</title>
        <searchString>
          | tstats prestats=t local=t count from `SA_SearchHistory` groupby searchtype, SearchHead | chart count over SearchHead by searchtype
        </searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="charting.chart">column</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
  </row>
  <row>
      <table>
        <title>Apps and Views Visited</title>
        <searchString>| tstats local=t  prestats=t count values(user)  from `SA_Events` where type=weblog user=$user$ groupby myapp myview | stats count values(user) as user by myapp, myview | stats sum(count) as "Total Hits" values(user) as "Users" list(count) as "Hits Per View" list(myview) as "Views" by myapp | rename myapp to "App" | sort - "Total Hits"</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
      </table>
  </row>
  <row>
      <html>
      <h1>Security</h1>
        <p>The below cover security risks and configurations.</p>
    </html>
  </row>
  <row>
      <table>
        <title>Exported Search Results</title>
        <searchString>[| tstats local=t count from `SA_SearchHistory` where NumExports&gt;0 user=$user$ groupby searchid | fields searchid ] `auditindex` `auditsourcetype` action=search  (((info=granted AND search=*) OR info=canceled OR info=failed OR info=completed) NOT searchparsetmp) OR (REST control OR acl OR export)   | rex "\s\/.*?\/jobs\/.*?\/(events|results)\/(?&lt;exported&gt;export)\]" | stats values(actualsearch) as actualsearch  sum(result_count) as sumresultcount count(eval(exported="export")) as NumExports by user, searchid | stats values(actualsearch) as Search  count as "Number of Users who Viewed" sum(sumresultcount) as "Number of Results" list(eval(if(NumExports&gt;0,NumExports,null))) as "Number of Exports" list(eval(if(NumExports&gt;0,user,null))) as "Users Who Exported"  by searchid | sort - NumExports, NumberOfUsersViewed | table searchid  "Number of Results" "Users Who Exported" "Number of Exports" Search</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
      <table>
        <title>Shared Search Results History</title>
        <searchString>[| tstats local=t count from `SA_SearchHistory` where WasShared=yes user=$user$ groupby searchid | fields searchid ] `auditindex` `auditsourcetype`   action=search info=granted (REST OR search=*) | rex "\s\/.*?\/jobs\/(?&lt;searchid&gt;.*?)\/(events|results)\/(?&lt;exported&gt;export)\]"  | stats values(actualsearch) as actualsearch count(eval(exported="export")) as NumExports by user, searchid | eval user=if(NumExports&gt;0,user . " (exported)",user)| stats values(actualsearch) as actualsearch  count as NumberOfUsersViewed  list(eval(if(NumExports&gt;0,NumExports,null))) as NumExports list(eval(if(NumExports&gt;0,user,null))) as UsersWhoExported values(user) as Users by searchid | sort - NumExports, NumberOfUsersViewed | table searchid NumberOfUsersViewed Users Users actualsearch</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <chart>
        <title>Logins by Hour of Day</title>
        <searchString>| tstats local=t  count from `SA_Events` where type=login user=$user$ groupby date_hour | chart sum(count) as "Number of Logins" by date_hour | rename date_hour as "Hour of Day"</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
      </chart>
      <table>
        <title>System Configuration Changes</title>
        <searchString>| tstats local=t  count from `SA_Events` where type=manager user=$user$ groupby _time uri_path | sort - _time | fields - count</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <html>
      <h1>Search Performance Detail</h1>
        <p>Credit for the below searches goes to the SOS team!</p>
    </html>
  </row>
  <row>
      <table>
        <title>Questionable Search Strings</title>
        <searchString>
          | tstats local=t values(actualsearch) as actualsearch values(savedsearch_name) as savedsearch_name max(total_run_time) as trt from `SA_SearchHistory` where user=$user$ ShouldInvestigate&gt;0 | eval search = if(isnull(savedsearch_name) OR savedsearch_name="", actualsearch, "(" . savedsearch_name . ") --- " . actualsearch) | cluster labelonly=t field=search | stats count as "# of Runs" avg(trt) as "Avg Runtime" sum(trt) as "Total Runtime" first(search) as "Representative Search String" by cluster_label | fields - cluster_label | sort - "Total Runtime"
        </searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">undefined</option>
        <option name="rowNumbers">undefined</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <table>
        <title>Common Search Commands</title>
        <searchTime>
          | tstats  local=t count as "Number of Searches"  from `SA_SearchHistory` where  user=$user$  groupby searchcommands | sort - "Number of Searches"
        </searchTime>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
      <table>
        <title>Search Commands Associated with Expensive Searches</title>
        <searchTime>
          | tstats  local=t count as "Number of Searches" avg(total_run_time) as "Avg Run Time" stdev(total_run_time) as "StDev Run Time" from `SA_SearchHistory` where  user=$user$ groupby searchcommands | sort - "Avg Run Time" | rename searchcommands as "Search Command"
        </searchTime>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="list.drilldown">full</option>
        <option name="list.wrap">1</option>
        <option name="maxLines">5</option>
        <option name="raw.drilldown">full</option>
        <option name="rowNumbers">false</option>
        <option name="table.drilldown">all</option>
        <option name="table.wrap">1</option>
        <option name="type">list</option>
        <option name="wrap">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <table>
        <title>Aggregate Search Performance by Fuzzy Grouping (cluster)</title>
        <searchString>
          | tstats  local=t values(actualsearch) as actualsearch values(savedsearch_name) as savedsearch_name values(searchtype) as searchtype avg(total_run_time) as total_run_time avg(result_count) as result_count from `SA_SearchHistory` where  user=$user$  groupby searchid | rex mode=sed field=savedsearch_name "s/_+\d*$//" | eval search = if(isnull(savedsearch_name) OR savedsearch_name="", actualsearch, "(" . savedsearch_name . ") --- " . actualsearch) | cluster labelonly=t field=search | stats count as "# Similar Searches" median(total_run_time) as "Median Run Time" avg(result_count) as "Avg Result Count" values(searchtype) as searchtype first(search) as "Representative Search String" by cluster_label | eval search=if(len(search)&gt;220, substr(search,1,220) . "[.......]", search)  | sort - "# Similar Searches" | fields - cluster_label
        </searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <fields>["# Similar Searches","Median Run Time","Avg Result Count","Representative Search String"]</fields>
      </table>
      <table>
        <title>Expensive Searches</title>
        <searchString>
          | tstats  local=t min(_time) as _time values(actualsearch) as actualsearch values(savedsearch_name) as savedsearch_name avg(total_run_time) as "Search Run Time" avg(result_count) as "Result Count" from `SA_SearchHistory` where  user=$user$  groupby searchid | rex mode=sed field=savedsearch_name "s/_+\d*$//" | eval search = if(isnull(savedsearch_name) OR savedsearch_name="", actualsearch, "(" . savedsearch_name . ") --- " . actualsearch) | sort - "Search Run Time" | fields - actualsearch savedsearch_name | eval search=if(len(search)&gt;220, substr(search,1,220) . "[.......]", search)  | fields _time "Search Run Time" "Result Count" search searchid
        </searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <drilldown>
          <link>/app/search_activity/per_search_view?form.searchid=$row.searchid$</link>
        </drilldown>
        <option name="count">10</option>
        <option name="drilldown">cell</option>
        <fields>["_time","Search Run Time","Result Count","search"]</fields>
      </table>
  </row>
  <row>
      <chart>
        <title>User Search Concurrency</title>
        <searchString>| tstats local=t  prestats=t avg(active_hist_searches) avg(active_realtime_searches) from `SA_Events` where type=search_concurrency user=$user$ groupby _time span=1d | timechart bins=50 avg(active_hist_searches) as "Avg Historical Search Count" avg(active_realtime_searches) as "Avg Realtime Search Count"</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
      <chart>
        <title>Search Performance Metrics Compared to Average</title>
        <searchString>| tstats local=t sum(total_run_time) as total_run_time avg(accuracy) as accuracy sum(result_count) as result_count sum(event_count) as event_count sum(scan_count) as scan_count sum(searchspan_m) as searchspan_m  from `SA_SearchHistory` where user=$user$ groupby _time | eval EventsPerSecond=event_count / total_run_time | eval ScannedPerSecond=scan_count / total_run_time| timechart span=1d avg(accuracy) as accuracy avg(*PerSecond) as *PerSecond avg(searchspan_m) as searchspan_m  avg(result_count) as result_count  | eventstats avg(accuracy) as avgaccuracy avg(EventsPerSecond) as avgEventsPerSecond avg(ScannedPerSecond) as avgScannedPerSecond avg(searchspan_m) as avgsearchspan_m avg(result_count) as avgresult_count | eval accuracy=round(100*(accuracy/avgaccuracy)) | eval EventsPerSecond=round(100*(EventsPerSecond/avgEventsPerSecond)) | eval ScannedPerSecond=round(100*(ScannedPerSecond/avgScannedPerSecond)) | eval searchspan_m=round(100*(searchspan_m/avgsearchspan_m)) | eval result_count=round(100*(result_count/avgresult_count)) | fields - avg* | rename accuracy AS "Accuracy (% Delta)" EventsPerSecond as "Events/Second (% Delta)" ScannedPerSecond as "Scanned/Second (% Delta)" searchspan_m as "Timespan (% Delta)" result_count as "# Results (% Delta)" | timechart bins=50 avg(*) as *</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.placement">right</option>
      </chart>
  </row>
  <row>
      <table>
        <title>Average Search Time Span</title>
        <searchString>| tstats local=t avg(searchspan_m) as searchspan_m  avg(searchspan_h) as searchspan_h avg(searchspan_d) as searchspan_d   from `SA_SearchHistory` where user=$user$ groupby user | where user!="n/a" | rename searchspan_m as "Search Timespan (min)" searchspan_d as "Search Timespan (day)" searchspan_h as "Search Timespan (hour)"</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
      </table>
  </row>
  <row>
      <html>
      <h1>Troubleshooting</h1>
        <p>The below provide very general troubleshooting guidelines:</p>
    </html>
  </row>
  <row>
      <chart>
        <title>Failed Searches</title>
        <searchString>| tstats local=t prestats=t count  from `SA_SearchHistory` where user=$user$ search_status=failed groupby user search_status _time span=1d  | timechart bins=50 count</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
      <chart>
        <title>Skipped Scheduled Searches</title>
        <searchString>| tstats local=t prestats=t count from `SA_Events` where type=scheduler user=$user$ status=skipped groupby status _time span=1d | timechart bins=50 count by status</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
  </row>
  <row>
      <chart>
        <title>Failed Searches with Runtime &gt; 0 seconds</title>
        <searchString>| tstats local=t prestats=t count  from `SA_SearchHistory` where search_status=failed total_run_time&gt;0 user=$user$ groupby _time span=1d | timechart bins=50 count</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
      <html>
        <h3>Important</h3>
        <p>While these assist you in understanding the user experience due to system isaes, they are not a substitute for real troubleshooting. It is highly recommended that you leverage SOS (Splunk on SplunkÂ®) to do real troubleshooting. Please find it on apps.splunk.com, <a href="http://apps.splunk.com/app/748/">here</a>.  </p>
    </html>
  </row>
  <row>
      <table>
        <title>Failed or Skipped Searches</title>
        <searchString>
          | tstats local=t min(_time) as _time values(actualsearch) as actualsearch values(savedsearch_name) as savedsearch_name values(search_status) as status from `SA_SearchHistory` where search_status=failed user=$user$ groupby user searchid search_status  | rex mode=sed field=savedsearch_name "s/_+\d*$//" | eval search = if(isnull(savedsearch_name) OR savedsearch_name="", actualsearch, "(" . savedsearch_name . ") --- " . actualsearch)       | eval search=if(len(search)&gt;220, substr(search,1,220) . "[.......]", search) | fields - savedsearch_name actualsearch searchid | sort - _time
        </searchString>
          <earliestTime>$field1.earliest$</earliestTime>
          <latestTime>$field1.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <table>
        <title>Recent Searches (Last 7 Days) - $user$</title>
        <searchString>
          | tstats local=t min(_time) as _time values(user) as user values(search_status) as status values(actualsearch) as actualsearch values(savedsearch_name) as savedsearch_name from `SA_SearchHistory` where user=$user$ groupby searchid | rex mode=sed field=savedsearch_name "s/_+\d*$//" | eval search = if(isnull(savedsearch_name) OR savedsearch_name="", actualsearch, "(" . savedsearch_name . ") --- " . actualsearch)  | eval search=if(len(search)&gt;420, substr(search,1,420) . "[.......]", search)  | sort - _time | fields - actualsearch savedsearch_name
	</searchString>
          <earliestTime>-7d@h</earliestTime>
          <latestTime>now</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <drilldown>
          <link>/app/search_activity/per_search_view?form.searchid=$row.searchid$</link>
        </drilldown>
        <option name="count">10</option>
        <option name="drilldown">cell</option>
        <fields>["_time","status","search"]</fields>
      </table>
  </row>
</form>
